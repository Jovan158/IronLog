import{c as j,d as t,a as M,b as S,u as I,r as w,j as e}from"./index-DSw6rzZA.js";import{u as P}from"./settingsStore-BT_5zqJA.js";import{C as y}from"./Card-J2pKyY-r.js";import{A as T,I as p,B as i,M as L}from"./Input-5INKq-7_.js";import{T as U}from"./trash-2-_CTqjij1.js";import"./index-CKQLG8D-.js";const O=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],R=j("download",O);const z=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],B=j("upload",z);async function _(){try{const[o,r,s,u,h]=await Promise.all([t.workoutPlans.toArray(),t.workoutSessions.toArray(),t.diaryEntries.toArray(),t.exercises.toArray(),t.coachMessages.toArray()]),m={version:1,exportedAt:new Date().toISOString(),workoutPlans:o,workoutSessions:r,diaryEntries:s,exercises:u,coachMessages:h},f=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),n=URL.createObjectURL(f),l=document.createElement("a");l.href=n,l.download=`ironlog-backup-${new Date().toISOString().split("T")[0]}.json`,l.click(),URL.revokeObjectURL(n)}catch(o){throw o}}async function $(o){try{const r=await o.text(),s=JSON.parse(r);if(!s.version||!s.workoutPlans)throw new Error("Invalid backup file format");await t.transaction("rw",[t.workoutPlans,t.workoutSessions,t.diaryEntries,t.exercises,t.coachMessages],async()=>{await t.workoutPlans.clear(),await t.workoutSessions.clear(),await t.diaryEntries.clear(),await t.exercises.clear(),await t.coachMessages.clear(),s.workoutPlans.length&&await t.workoutPlans.bulkAdd(s.workoutPlans),s.workoutSessions.length&&await t.workoutSessions.bulkAdd(s.workoutSessions),s.diaryEntries.length&&await t.diaryEntries.bulkAdd(s.diaryEntries),s.exercises.length&&await t.exercises.bulkAdd(s.exercises),s.coachMessages.length&&await t.coachMessages.bulkAdd(s.coachMessages)})}catch(r){throw r}}async function F(){try{await t.transaction("rw",[t.workoutPlans,t.workoutSessions,t.diaryEntries,t.exercises,t.coachMessages],async()=>{await t.workoutPlans.clear(),await t.workoutSessions.clear(),await t.diaryEntries.clear(),await t.exercises.clear(),await t.coachMessages.clear()}),await M()}catch(o){throw o}}function Q(){const o=S(),{showToast:r}=I(),{aiCoachMode:s,apiEndpoint:u,apiKey:h,apiModel:m,units:f,setAiCoachMode:n,setApiEndpoint:l,setApiKey:v,setApiModel:b,setUnits:E}=P(),[N,c]=w.useState(!1),[g,d]=w.useState(""),x=w.useRef(null),A=async()=>{try{await _(),r("Data exported","success")}catch{r("Failed to export data","error")}},C=async a=>{const k=a.target.files?.[0];if(k){try{await $(k),r("Data imported successfully","success")}catch{r("Failed to import data","error")}x.current&&(x.current.value="")}},D=async()=>{if(g==="DELETE")try{await F(),r("All data deleted","success"),c(!1),d("")}catch{r("Failed to delete data","error")}};return e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o(-1),className:"text-text-muted hover:text-text-primary transition-colors","aria-label":"Go back",children:e.jsx(T,{size:20})}),e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Settings"})]}),e.jsxs(y,{className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"AI Coach Mode"}),e.jsx("div",{className:"flex gap-2",children:["builtin","api"].map(a=>e.jsx("button",{onClick:()=>n(a),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-colors ${s===a?"bg-accent text-black":"bg-surface-alt text-text-secondary hover:text-text-primary"}`,children:a==="builtin"?"Built-in":"Custom API"},a))}),s==="api"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(p,{label:"API Endpoint",value:u,onChange:a=>l(a.target.value),placeholder:"https://api.openai.com/v1/chat/completions"}),e.jsx(p,{label:"API Key",type:"password",value:h,onChange:a=>v(a.target.value),placeholder:"sk-..."}),e.jsx(p,{label:"Model",value:m,onChange:a=>b(a.target.value),placeholder:"gpt-3.5-turbo"})]})]}),e.jsxs(y,{className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Units"}),e.jsx("div",{className:"flex gap-2",children:["kg","lbs"].map(a=>e.jsx("button",{onClick:()=>E(a),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-colors ${f===a?"bg-accent text-black":"bg-surface-alt text-text-secondary hover:text-text-primary"}`,children:a.toUpperCase()},a))})]}),e.jsxs(y,{className:"flex flex-col gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Data Management"}),e.jsxs(i,{variant:"ghost",onClick:A,className:"flex items-center gap-2 justify-start w-full",children:[e.jsx(R,{size:16}),"Export Data"]}),e.jsxs(i,{variant:"ghost",onClick:()=>x.current?.click(),className:"flex items-center gap-2 justify-start w-full",children:[e.jsx(B,{size:16}),"Import Data"]}),e.jsx("input",{ref:x,type:"file",accept:".json",onChange:C,className:"hidden"}),e.jsxs(i,{variant:"destructive",onClick:()=>c(!0),className:"flex items-center gap-2 justify-center w-full",children:[e.jsx(U,{size:16}),"Delete All Data"]})]}),e.jsx(L,{isOpen:N,onClose:()=>{c(!1),d("")},title:"Delete All Data",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["This will permanently delete all your workout plans, sessions, diary entries, and messages. Type ",e.jsx("strong",{className:"text-destructive",children:"DELETE"})," to confirm."]}),e.jsx(p,{value:g,onChange:a=>d(a.target.value),placeholder:'Type "DELETE" to confirm'}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{variant:"ghost",onClick:()=>{c(!1),d("")},className:"flex-1",children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:D,disabled:g!=="DELETE",className:"flex-1",children:"Delete Everything"})]})]})})]})}export{Q as default};
