import{c as x,d,r as l,j as e,M as g}from"./index-CuPckX_d.js";import{g as u}from"./index-DCNarqpm.js";import{c as f,C as p,a as h,b as y,d as b}from"./index-RmKKg3j7.js";import{u as j}from"./settingsStore-D_n6jtFV.js";const w=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],C=x("arrow-up",w);function M(s){const t=s.toLowerCase();for(const a of h)if(a.keywords.some(o=>t.includes(o)))return a.response;return y}async function N(s,t,a,o){const n=[{role:"system",content:p},...s.map(c=>({role:c.role,content:c.content}))],r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:o,messages:n})});if(!r.ok)throw new Error(`API request failed: ${r.status}`);return(await r.json()).choices[0].message.content}const m=f((s,t)=>({messages:[],isLoading:!1,loadMessages:async()=>{try{const a=await d.coachMessages.orderBy("timestamp").toArray();s({messages:a})}catch{}},sendMessage:async a=>{const o={id:u(),role:"user",content:a,timestamp:new Date};s(n=>({messages:[...n.messages,o],isLoading:!0}));try{await d.coachMessages.add(o);const n=j.getState();let r;n.aiCoachMode==="api"&&n.apiKey?r=await N([...t().messages],n.apiEndpoint,n.apiKey,n.apiModel):r=M(a);const i={id:u(),role:"assistant",content:r,timestamp:new Date};await d.coachMessages.add(i),s(c=>({messages:[...c.messages,i],isLoading:!1}))}catch{const r={id:u(),role:"assistant",content:"Sorry, something went wrong. Please try again.",timestamp:new Date};s(i=>({messages:[...i.messages,r],isLoading:!1}))}},clearMessages:async()=>{try{await d.coachMessages.clear(),s({messages:[]})}catch{}}})),v=l.memo(function({message:t}){const a=t.role==="user";return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] px-4 py-2 text-sm whitespace-pre-wrap ${a?"bg-surface-alt rounded-2xl rounded-br-sm text-text-primary":"bg-surface rounded-2xl rounded-bl-sm text-text-primary"}`,children:t.content})})});function S({onSend:s,disabled:t}){const[a,o]=l.useState(""),n=l.useRef(null),r=()=>{!a.trim()||t||(s(a.trim()),o(""),n.current&&(n.current.style.height="auto"))},i=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),r())};return e.jsx("div",{className:"bg-surface border-t border-border-default px-4 py-3",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("textarea",{ref:n,value:a,onChange:c=>{o(c.target.value),c.target.style.height="auto",c.target.style.height=`${Math.min(c.target.scrollHeight,120)}px`},onKeyDown:i,placeholder:"Ask me anything...",rows:1,className:"flex-1 bg-surface-alt border border-border-default rounded-xl px-3 py-2 text-sm text-text-primary placeholder:text-text-muted focus:border-accent focus:outline-none resize-none max-h-[120px]"}),e.jsx("button",{onClick:r,disabled:!a.trim()||t,className:"bg-accent text-black p-2 rounded-xl hover:bg-accent-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0","aria-label":"Send message",children:e.jsx(C,{size:18})})]})})}function E(){return e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-surface rounded-2xl rounded-bl-sm px-4 py-3 flex gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-text-muted animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-text-muted animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 rounded-full bg-text-muted animate-bounce",style:{animationDelay:"300ms"}})]})})}function k({onSelect:s}){return e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:b.map(t=>e.jsx("button",{onClick:()=>s(t),className:"bg-surface-alt text-text-secondary text-xs rounded-full px-3 py-1.5 hover:text-text-primary transition-colors",children:t},t))})}function A(){const{messages:s,isLoading:t,sendMessage:a}=m(),o=l.useRef(null);l.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[s,t]);const n=r=>{a(r)};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-8rem)]",children:[e.jsx("div",{ref:o,className:"flex-1 overflow-y-auto px-4 py-4",children:s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[e.jsx(g,{size:40,className:"text-text-muted"}),e.jsx("p",{className:"text-sm text-text-secondary text-center",children:"Ask me anything about fitness, nutrition, or training"}),e.jsx(k,{onSelect:n})]}):e.jsxs("div",{className:"flex flex-col gap-3",children:[s.map(r=>e.jsx(v,{message:r},r.id)),t&&e.jsx(E,{})]})}),e.jsx(S,{onSend:n,disabled:t})]})}function _(){const s=m(t=>t.loadMessages);return l.useEffect(()=>{s()},[s]),e.jsx(A,{})}export{_ as default};
