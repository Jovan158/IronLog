import{c as M,D as H,e as P}from"./index-RmKKg3j7.js";function w(a,r){let n;try{n=a()}catch{return}return{getItem:i=>{var e;const d=m=>m===null?null:JSON.parse(m,void 0),l=(e=n.getItem(i))!=null?e:null;return l instanceof Promise?l.then(d):d(l)},setItem:(i,e)=>n.setItem(i,JSON.stringify(e,void 0)),removeItem:i=>n.removeItem(i)}}const _=a=>r=>{try{const n=a(r);return n instanceof Promise?n:{then(o){return _(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return _(o)(n)}}}},D=(a,r)=>(n,o,i)=>{let e={storage:w(()=>window.localStorage),partialize:t=>t,version:0,merge:(t,h)=>({...h,...t}),...r},d=!1,l=0;const m=new Set,g=new Set;let c=e.storage;if(!c)return a((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),n(...t)},o,i);const y=()=>{const t=e.partialize({...o()});return c.setItem(e.name,{state:t,version:e.version})},A=i.setState;i.setState=(t,h)=>(A(t,h),y());const v=a((...t)=>(n(...t),y()),o,i);i.getInitialState=()=>v;let f;const E=()=>{var t,h;if(!c)return;const S=++l;d=!1,m.forEach(s=>{var u;return s((u=o())!=null?u:v)});const p=((h=e.onRehydrateStorage)==null?void 0:h.call(e,(t=o())!=null?t:v))||void 0;return _(c.getItem.bind(c))(e.name).then(s=>{if(s)if(typeof s.version=="number"&&s.version!==e.version){if(e.migrate){const u=e.migrate(s.state,s.version);return u instanceof Promise?u.then(I=>[!0,I]):[!0,u]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,s.state];return[!1,void 0]}).then(s=>{var u;if(S!==l)return;const[I,b]=s;if(f=e.merge(b,(u=o())!=null?u:v),n(f,!0),I)return y()}).then(()=>{S===l&&(p?.(f,void 0),f=o(),d=!0,g.forEach(s=>s(f)))}).catch(s=>{S===l&&p?.(void 0,s)})};return i.persist={setOptions:t=>{e={...e,...t},t.storage&&(c=t.storage)},clearStorage:()=>{c?.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>E(),hasHydrated:()=>d,onHydrate:t=>(m.add(t),()=>{m.delete(t)}),onFinishHydration:t=>(g.add(t),()=>{g.delete(t)})},e.skipHydration||E(),f||v},F=D,N=M()(F(a=>({aiCoachMode:"builtin",apiEndpoint:P,apiKey:"",apiModel:H,units:"kg",setAiCoachMode:r=>a({aiCoachMode:r}),setApiEndpoint:r=>a({apiEndpoint:r}),setApiKey:r=>a({apiKey:r}),setApiModel:r=>a({apiModel:r}),setUnits:r=>a({units:r})}),{name:"ironlog-settings"}));export{N as u};
