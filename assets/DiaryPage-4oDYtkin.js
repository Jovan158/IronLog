import{c as C,d as b,r as f,j as e,X as S}from"./index-CuPckX_d.js";import{d as h,g as v,e as N,i as E,h as T}from"./index-DCNarqpm.js";import{c as M,M as D}from"./index-RmKKg3j7.js";import{C as A,P as G,T as W}from"./Tabs-0DbTk7qW.js";import{C as w}from"./chevron-right-BTLWweWF.js";import{u as F}from"./workoutStore-B_RAjTId.js";import{C as j}from"./Card-BMgYyUst.js";const L=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],k=C("chevron-left",L);function R(n){return{id:v(),date:n,content:"",goals:[],mood:3,createdAt:new Date,updatedAt:new Date}}const y=M((n,i)=>({entries:[],selectedDate:h(new Date),isLoading:!1,loadEntries:async()=>{n({isLoading:!0});try{const t=await b.diaryEntries.toArray();n({entries:t,isLoading:!1})}catch{n({isLoading:!1})}},setSelectedDate:t=>n({selectedDate:t}),getEntryForDate:t=>i().entries.find(a=>a.date===t),saveEntry:async t=>{const a=i().getEntryForDate(t.date),r=a?{...a,...t,updatedAt:new Date}:{...R(t.date),...t};try{await b.diaryEntries.put(r),n(c=>({entries:a?c.entries.map(s=>s.id===r.id?r:s):[...c.entries,r]}))}catch{}},setMood:async(t,a)=>{await i().saveEntry({date:t,mood:a})},addGoal:async(t,a)=>{const r=i().getEntryForDate(t),c={id:v(),text:a,isCompleted:!1},s=r?[...r.goals,c]:[c];await i().saveEntry({date:t,goals:s})},toggleGoal:async(t,a)=>{const r=i().getEntryForDate(t);if(!r)return;const c=r.goals.map(s=>s.id===a?{...s,isCompleted:!s.isCompleted}:s);await i().saveEntry({date:t,goals:c})},removeGoal:async(t,a)=>{const r=i().getEntryForDate(t);if(!r)return;const c=r.goals.filter(s=>s.id!==a);await i().saveEntry({date:t,goals:c})},updateContent:async(t,a)=>{await i().saveEntry({date:t,content:a})},getWeeklySummary:(t,a)=>{const{entries:r}=i(),c=t.map(x=>{const m=r.find(l=>l.date===h(x));return m?m.mood:null}),s=t.map(x=>r.find(m=>m.date===h(x))).filter(Boolean),o=s.reduce((x,m)=>x+m.goals.length,0),p=s.reduce((x,m)=>x+m.goals.filter(l=>l.isCompleted).length,0),d=o>0?Math.round(p/o*100):0;return{moods:c,goalCompletionRate:d,workoutCount:a}}})),z=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function $({selectedDate:n,onSelectDate:i}){const[t,a]=f.useState(new Date),r=N(t),c=()=>{const o=new Date(t);o.setDate(o.getDate()-7),a(o)},s=()=>{const o=new Date(t);o.setDate(o.getDate()+7),a(o)};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:c,className:"text-text-muted hover:text-text-primary p-1 transition-colors","aria-label":"Previous week",children:e.jsx(k,{size:18})}),e.jsx("span",{className:"text-xs text-text-secondary",children:r[0].toLocaleDateString("en-US",{month:"short",year:"numeric"})}),e.jsx("button",{onClick:s,className:"text-text-muted hover:text-text-primary p-1 transition-colors","aria-label":"Next week",children:e.jsx(w,{size:18})})]}),e.jsx("div",{className:"flex gap-1",children:r.map((o,p)=>{const d=h(o),x=d===n,m=E(o);return e.jsxs("button",{onClick:()=>i(d),className:`flex-1 flex flex-col items-center gap-0.5 py-2 rounded-lg transition-colors ${x?"bg-surface-alt":"hover:bg-surface-alt/50"}`,children:[e.jsx("span",{className:"text-[10px] text-text-muted",children:z[p]}),e.jsx("span",{className:`text-sm font-medium ${x?"text-accent":"text-text-secondary"}`,children:o.getDate()}),m&&e.jsx("div",{className:"w-1 h-1 rounded-full bg-accent"})]},d)})})]})}const P=[1,2,3,4,5];function I({selected:n,onSelect:i}){return e.jsx("div",{className:"flex gap-2",children:P.map(t=>e.jsx("button",{onClick:()=>i(t),className:`text-2xl p-2 rounded-xl transition-all ${n===t?"ring-2 ring-accent bg-surface-alt scale-110":"hover:bg-surface-alt"}`,"aria-label":`Mood ${t} of 5`,children:D[t]},t))})}function O({goals:n,onToggle:i,onAdd:t,onRemove:a}){const[r,c]=f.useState(!1),[s,o]=f.useState(""),p=()=>{s.trim()&&(t(s.trim()),o(""),c(!1))};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Today's Goals"}),n.map(d=>e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx("button",{onClick:()=>i(d.id),className:`w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-colors ${d.isCompleted?"bg-success border-success":"border-border-default hover:border-accent"}`,"aria-label":d.isCompleted?"Mark goal incomplete":"Mark goal complete",children:d.isCompleted&&e.jsx(A,{size:12,className:"text-black"})}),e.jsx("span",{className:`text-sm flex-1 ${d.isCompleted?"text-text-muted line-through":"text-text-primary"}`,children:d.text}),e.jsx("button",{onClick:()=>a(d.id),className:"text-text-muted hover:text-destructive opacity-0 group-hover:opacity-100 transition-all p-0.5","aria-label":"Remove goal",children:e.jsx(S,{size:14})})]},d.id)),r?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{autoFocus:!0,value:s,onChange:d=>o(d.target.value),onKeyDown:d=>{d.key==="Enter"&&p(),d.key==="Escape"&&(c(!1),o(""))},onBlur:()=>{s.trim()?p():c(!1)},placeholder:"Enter a goal...",className:"flex-1 bg-surface-alt border border-border-default rounded-lg px-3 py-1.5 text-sm text-text-primary placeholder:text-text-muted focus:border-accent focus:outline-none"})}):e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-1.5 text-sm text-text-secondary hover:text-text-primary transition-colors py-1 self-start",children:[e.jsx(G,{size:14}),"Add Goal"]})]})}function _({date:n}){const{setMood:i,addGoal:t,toggleGoal:a,removeGoal:r,updateContent:c}=y(),s=y(l=>l.getEntryForDate(n)),o=f.useRef(null),p=f.useMemo(()=>T(l=>c(n,l),500),[n,c]),d=f.useCallback(l=>{i(n,l)},[n,i]),x=l=>{p(l)};f.useEffect(()=>{o.current&&s?o.current.value=s.content:o.current&&(o.current.value="")},[n,s]);const m=()=>{const l=o.current;l&&(l.style.height="auto",l.style.height=`${Math.max(200,l.scrollHeight)}px`)};return e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(I,{selected:s?.mood??3,onSelect:d}),e.jsx(O,{goals:s?.goals??[],onToggle:l=>a(n,l),onAdd:l=>t(n,l),onRemove:l=>r(n,l)}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-sm font-semibold text-text-primary",children:"Journal"}),e.jsx("textarea",{ref:o,onChange:l=>{x(l.target.value),m()},placeholder:"How was your day?",className:"bg-surface-alt border border-border-default rounded-lg px-3 py-2 text-sm text-text-primary placeholder:text-text-muted focus:border-accent focus:outline-none resize-none min-h-[200px]"})]})]})}function B(){const{loadEntries:n,getWeeklySummary:i}=y(),{sessions:t,loadSessions:a}=F(),[r,c]=f.useState(new Date);f.useEffect(()=>{n(),a()},[n,a]);const s=N(r),o=h(s[0]),p=h(s[6]),d=t.filter(u=>{if(!u.completedAt)return!1;const g=h(new Date(u.startedAt));return g>=o&&g<=p}).length,x=i(s,d),m=()=>{const u=new Date(r);u.setDate(u.getDate()-7),c(u)},l=()=>{const u=new Date(r);u.setDate(u.getDate()+7),c(u)};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:m,className:"text-text-muted hover:text-text-primary p-1 transition-colors","aria-label":"Previous week",children:e.jsx(k,{size:18})}),e.jsxs("span",{className:"text-sm text-text-secondary",children:[s[0].toLocaleDateString("en-US",{month:"short",day:"numeric"})," -"," ",s[6].toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsx("button",{onClick:l,className:"text-text-muted hover:text-text-primary p-1 transition-colors","aria-label":"Next week",children:e.jsx(w,{size:18})})]}),e.jsxs(j,{children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary mb-3",children:"Mood Trend"}),e.jsx("div",{className:"flex justify-between items-end h-20 px-2",children:x.moods.map((u,g)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg",children:D[u]}),e.jsx("div",{className:"w-2 rounded-full bg-accent",style:{height:`${u/5*48}px`}})]}):e.jsx("div",{className:"w-2 h-2 rounded-full bg-border-default"}),e.jsx("span",{className:"text-[10px] text-text-muted",children:["M","T","W","T","F","S","S"][g]})]},g))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(j,{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:[x.goalCompletionRate,"%"]}),e.jsx("p",{className:"text-xs text-text-muted",children:"Goals Completed"})]}),e.jsxs(j,{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-text-primary",children:x.workoutCount}),e.jsx("p",{className:"text-xs text-text-muted",children:"Workouts"})]})]})]})}const U=[{id:"day",label:"Day"},{id:"week",label:"Week"}];function V(){const{selectedDate:n,setSelectedDate:i,loadEntries:t}=y(),[a,r]=f.useState("day");return f.useEffect(()=>{t()},[t]),e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Diary"}),e.jsx(W,{tabs:U,activeTab:a,onTabChange:r}),a==="day"&&e.jsxs(e.Fragment,{children:[e.jsx($,{selectedDate:n,onSelectDate:i}),e.jsx(_,{date:n})]}),a==="week"&&e.jsx(B,{})]})}export{V as default};
