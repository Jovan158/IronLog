import{d as l}from"./index-DSw6rzZA.js";import{g as p}from"./index-DCNarqpm.js";import{c as y}from"./index-CKQLG8D-.js";const S=y((c,i)=>({plans:[],sessions:[],activeSession:null,isLoading:!1,loadPlans:async()=>{try{const e=await l.workoutPlans.toArray();c({plans:e})}catch{}},loadSessions:async()=>{try{const e=await l.workoutSessions.orderBy("startedAt").reverse().toArray();c({sessions:e})}catch{}},createPlan:async e=>{const t={id:p(),name:e,days:[],createdAt:new Date,updatedAt:new Date};try{await l.workoutPlans.add(t),c(s=>({plans:[...s.plans,t]}))}catch{}return t},updatePlan:async e=>{const t={...e,updatedAt:new Date};try{await l.workoutPlans.put(t),c(s=>({plans:s.plans.map(n=>n.id===e.id?t:n)}))}catch{}},deletePlan:async e=>{try{await l.workoutPlans.delete(e),c(t=>({plans:t.plans.filter(s=>s.id!==e)}))}catch{}},addDayToPlan:async(e,t)=>{const s=i().plans.find(r=>r.id===e);if(!s)return;const n={id:p(),name:t,exercises:[],order:s.days.length},a={...s,days:[...s.days,n],updatedAt:new Date};await i().updatePlan(a)},removeDayFromPlan:async(e,t)=>{const s=i().plans.find(a=>a.id===e);if(!s)return;const n={...s,days:s.days.filter(a=>a.id!==t).map((a,r)=>({...a,order:r})),updatedAt:new Date};await i().updatePlan(n)},updateDay:async(e,t)=>{const s=i().plans.find(a=>a.id===e);if(!s)return;const n={...s,days:s.days.map(a=>a.id===t.id?t:a),updatedAt:new Date};await i().updatePlan(n)},addExerciseToDay:async(e,t,s)=>{const n=i().plans.find(o=>o.id===e);if(!n)return;const a=n.days.find(o=>o.id===t);if(!a)return;const r={...a,exercises:[...a.exercises,s]};await i().updateDay(e,r)},removeExerciseFromDay:async(e,t,s)=>{const n=i().plans.find(o=>o.id===e);if(!n)return;const a=n.days.find(o=>o.id===t);if(!a)return;const r={...a,exercises:a.exercises.filter(o=>o.id!==s).map((o,d)=>({...o,order:d}))};await i().updateDay(e,r)},startSession:async(e,t,s,n)=>{const a={id:p(),planId:e,dayId:t,dayName:s,startedAt:new Date,completedAt:null,exercises:n};c({activeSession:a})},updateSet:(e,t,s)=>{const{activeSession:n}=i();if(!n)return;const a=[...n.exercises],r={...a[e]},o=[...r.sets];o[t]={...o[t],...s},r.sets=o,a[e]=r,c({activeSession:{...n,exercises:a}})},addSet:e=>{const{activeSession:t}=i();if(!t)return;const s=[...t.exercises],n={...s[e]},a={id:p(),setNumber:n.sets.length+1,weight:0,reps:0,isCompleted:!1,isPR:!1};n.sets=[...n.sets,a],s[e]=n,c({activeSession:{...t,exercises:s}})},completeSet:(e,t)=>{const{activeSession:s,checkIsPR:n}=i();if(!s)return;const a=[...s.exercises],r={...a[e]},o=[...r.sets],d=o[t],u=n(r.exerciseId,d.weight,d.reps);o[t]={...d,isCompleted:!d.isCompleted,isPR:u&&!d.isCompleted},r.sets=o,a[e]=r,c({activeSession:{...s,exercises:a}})},finishSession:async()=>{const{activeSession:e}=i();if(!e)return;const t={...e,completedAt:new Date};try{await l.workoutSessions.add(t),c(s=>({activeSession:null,sessions:[t,...s.sessions]}))}catch{}},cancelSession:()=>{c({activeSession:null})},getPreviousSession:(e,t)=>i().sessions.find(s=>s.planId===e&&s.dayId===t&&s.completedAt!==null),checkIsPR:(e,t,s)=>{if(t<=0||s<=0)return!1;const n=t*s,{sessions:a}=i();for(const r of a)for(const o of r.exercises)if(o.exerciseId===e){for(const d of o.sets)if(d.isCompleted&&d.weight*d.reps>=n)return!1}return!0}}));export{S as u};
